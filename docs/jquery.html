<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <title>Как использовать RequireJS с jQuery</title>

    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="../main.css">
    <link rel="icon" type="image/x-icon" href="/favicon.png">
    <!--[if IE]> <link rel="stylesheet" type="text/css" href="../ie.css" /> <![endif]-->
    <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/dojo/1.4/dojox/highlight/resources/highlight.css">

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script type="text/javascript" src="../init.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.4/dojo/dojo.xd.js"></script>
    <script type="text/javascript">
        dojo.require("dojox.highlight");
        dojo.require("dojox.highlight.languages.javascript");
        dojo.require("dojox.highlight.languages.html");
        dojo.ready(function() {
            dojo.query("pre > code")
                .forEach(function(node) {
                    if (node.innerHTML.indexOf("DOCTYPE") !== -1 || node.innerHTML.indexOf('&lt;script') !== -1) {
                        dojo.addClass(node, "html");
                    } else {
                        dojo.addClass(node, "javascript");
                    }
                })
                .forEach(dojox.highlight.init);
        });
    </script>
</head>
<body>
<div id="grid"></div>
<div id="wrapper">

    <div id="navBg"></div>
    <div id="nav" class="mono">
        <a class="homeImageLink" href="../"></a>
        <h1>загрузчик модулей для javascript</h1>

        <div class="alert">Это любительский перевод <a href="http://requirejs.org/">официальной документации</a>. Если Вы хотите помочь с переводом или нашли ошибку - сделайте мир лучше, посетив <a href="https://github.com/TuiKiken/requirejs-russian">страничку проекта на GitHub</a>.</div>
        <div class="alert-space"></div>

        <ul>
            <li class="hbox">
                <a href="../">Домашняя страница</a>
                <span class="spacer boxFlex"></span>
                <span class="icon home"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a class="local" href="start.html">Начать изучение</a>
                <span class="spacer boxFlex"></span>
                <span class="icon start"></span>
            </li>
            <li class="hbox">
                <a class="local" href="download.html">Скачать</a>
                <span class="spacer boxFlex"></span>
                <span class="icon download"></span>
            </li>
            <li class="hbox">
                <a class="local" href="api.html">API</a>
                <span class="spacer boxFlex"></span>
                <span class="icon api"></span>
            </li>
            <li class="hbox">
                <a class="local" href="optimization.html">Оптимизация</a>
                <span class="spacer boxFlex"></span>
                <span class="icon optimize"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a class="local" href="jquery.html">Использовать с jQuery</a>
                <span class="spacer boxFlex"></span>
                <span class="icon script"></span>
            </li>
            <li class="hbox">
                <a class="local" href="node.html">Использовать с Node</a>
                <span class="spacer boxFlex"></span>
                <span class="icon script"></span>
            </li>
            <li class="hbox">
                <a class="local" href="dojo.html">Использовать с Dojo</a>
                <span class="spacer boxFlex"></span>
                <span class="icon script"></span>
            </li>
            <li class="hbox">
                <a class="local" href="commonjs.html">CommonJS примечания</a>
                <span class="spacer boxFlex"></span>
                <span class="icon script"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a class="local" href="faq.html">FAQs</a>
                <span class="spacer boxFlex"></span>
                <span class="icon question"></span>
            </li>
            <li class="hbox">
                <a class="local" href="errors.html">Частые ошибки</a>
                <span class="spacer boxFlex"></span>
                <span class="icon question"></span>
            </li>
            <li class="hbox">
                <a class="local" href="plugins.html">Написание плагинов</a>
                <span class="spacer boxFlex"></span>
                <span class="icon api"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a class="local" href="why.html">Почему веб-модули</a>
                <span class="spacer boxFlex"></span>
                <span class="icon question"></span>
            </li>
            <li class="hbox">
                <a class="local" href="whyamd.html">Почему AMD</a>
                <span class="spacer boxFlex"></span>
                <span class="icon question"></span>
            </li>
            <li class="hbox">
                <a class="local" href="requirements.html">Требования</a>
                <span class="spacer boxFlex"></span>
                <span class="icon requirement"></span>
            </li>
            <li class="hbox">
                <a class="local" href="history.html">История</a>
                <span class="spacer boxFlex"></span>
                <span class="icon history"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a href="http://groups.google.com/group/requirejs">Попросить помощи</a>
                <span class="spacer boxFlex"></span>
                <span class="icon help"></span>
            </li>
            <li class="hbox">
                <a href="http://tagneto.blogspot.com">Блог</a>
                <span class="spacer boxFlex"></span>
                <span class="icon blog"></span>
            </li>
            <li class="hbox">
                <a href="http://twitter.com/jrburke">Twitter</a>
                <span class="spacer boxFlex"></span>
                <span class="icon twitter"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a href="http://github.com/jrburke/requirejs">GitHub</a>
                <span class="spacer boxFlex"></span>
                <span class="icon git"></span>
            </li>
            <li class="hbox">
                <a class="local" href="contributing.html">Содействовать</a>
                <span class="spacer boxFlex"></span>
                <span class="icon fork"></span>
            </li>
        </ul>


        <ul>
            <li class="version">Документация для v.2.1.4 (<a href="https://github.com/jrburke/requirejs/wiki/Upgrading-to-RequireJS-2.1">как обновиться до v.2.1</a>)</li>
            <li class="version"><a class="local" href="http://requirejs.org/docs/1.0/">Документация для v.1.0</a></li>
        </ul>

    </div>

    <div id="content"><div id="directory" class="section">
<h1>Как использовать RequireJS с jQuery</h1>
<ul class="index mono">
    <li class="hbox">
        <a href="#get">Получение RequireJS</a><span class="spacer boxFlex"></span><span class="sect">&sect; 1</span>
    </li>
    <li class="hbox">
        <a href="#setup">Создайте свою HTML страницу</a><span class="spacer boxFlex"></span><span class="sect">&sect; 2</span>
    </li>
    <li class="hbox">
        <a href="#optimize">Почувствуйте жажду скорости</a><span class="spacer boxFlex"></span><span class="sect">&sect; 3</span>
    </li>
    <li class="hbox">
        <a href="#advanced">Дополнительные возможности использования</a><span class="spacer boxFlex"></span><span class="sect">&sect; 4</span>
    </li>
</ul>
<p>Когда проект достигает определённого размера, управление модулями скриптов проекта становится сложным. Вы должны быть уверены, что скрипты указаны в правильном порядке и вы начинаете серьёзно задумываться об объединении скриптов в один для развертывания, чтобы загрузка скриптов происходила одним или небольшим количеством запросов.</p>

<p>Также вы можете загружать код на лету, после загрузки страницы.</p>


<p>RequireJS поможет вам управлять модулями скриптов, загружать их в правильном порядке и может потом легко скомбинировать скрипты через <a href="optimization.html">оптимизатор</a> RequireJS без необходимости изменять разметку. Это также даёт вам возможность загружать скрипты после того, как страница уже загружена, что позволяет разложить загружаемый объём с течением времени. </p>

<p>RequireJS имеет модульную систему, которая позволяет определять модули с ограниченной областью видимости, но из этого не следует, что система даёт преимущества управления зависимостями и оптимизации времени сборки. Со временем, если вы начинаете создавать более модульный код, который дожен быть повторно используемым во многих местах, модуль формата RequireJS позволяет легко написать инкапсулированный код, который может быть загружен на лету. Он может расти вместе с вами, особенно если вы захотите включить интернационализацию (i18n) строковых ресурсов для локализации вашего проекта на других языках или загрузить некоторые HTML строки и убедиться, что эти строки доступны перед выполнением кода или даже использовать JSONP сервисами в качестве зависимостей.</p>

</div>

<div class="section">
<h2>
<a name="get">Получение RequireJS</a>
<span class="sectionMark">&sect; 1</span>
</h2>

<p>Первые шаги для RequireJS:</p>
<ul>
    <li><a href="download.html#samplejquery">Скачать демонстрационный проект</a>.</li>
</ul>

<p>Этот демонстрационный проект использует объединённый файл jQuery + RequireJS. Если вы предпочитаете не связывать jQuery с RequireJS, в<a href="https://github.com/jrburke/require-jquery">README демонстрационного проекта</a> есть альтернативный путь использовать jQuery с RequireJS, но это требует рассмотрения большего количества крайних случаев.</p>

</div>

<div class="section">
<h2>
<a name="setup">Создайте свою HTML страницу</a>
<span class="sectionMark">&sect; 2</span>
</h2>

<p>Образец HTML страницы будет выглядеть следующим образом (если вы положите все JS-файлы в подкаталоге "script"):</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Образец страницы jQuery+RequireJS&lt;/title&gt;
        &lt;script data-main="scripts/main" src="scripts/require-jquery.js"&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;образец страницы jQuery+RequireJS&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>Атрибут data-main в теге script указывает RequireJS загрузить файл scripts/main.js. RequireJS загрузит любую зависимость, которая передаётся в require() без ".js" файла из той директории, которая используется в data-main. Если вам удобнее указывать полный путь, можете сделать следующее:</p>

<pre><code>&lt;script data-main="scripts/main.js" src="scripts/require-jquery.js"&gt;&lt;/script&gt;
</code></pre>

<p>Что находится в main.js? Вызов require() загружает все скрипты, которые вам нужны и выполняет любые действия для инициализации на этой странице. Это образец скрипта main.js, который загружает два плагина: jquery.alpha.js и jquery.beta.js (имена не реальных плагинов, просто пример). Плагины должны быть в том же каталоге, где и require-jquery.js:</p>

<p>main.js:</p>

<pre><code>require(["jquery", "jquery.alpha", "jquery.beta"], function($) {
    //плагины jquery.alpha.js и jquery.beta.js были загружены.
    $(function() {
        $('body').alpha().beta();
    });
});
</code></pre>

<p>В вызове require(), "jquery" указана как зависимость. Файл require-jquery.js имеет специальный код для регистрации jQuery как модуля RequireJS и так как он зарегистрирован в качестве модуля, вы можете получить дескриптор этого модуля как первый агрумент функции обратного вызова, переданного в require. В вышеприведённом примере, $ используется для ссылки на модуль jQuery.</p>

<p>Так как jquery.alpha и jquery.beta - просто плагины, расширяющие jQuery, они не возвращают модули, на которые можно ссылаться в качестве аргументов функции.</p>

</div>

<div class="section">
<h2>
<a name="optimize">Почувствуйте жажду скорости</a>
<span class="sectionMark">&sect; 3</span>
</h2>

<p>Теперь ваша страница подготовлена для очень лёгкой оптимизации с помощью <a href="optimization.html">оптимизатора</a>.</p>

<p>Если вы загрузили пример проекта jQuery, то оптимизатор, который является частью исходного кода RequireJS, уже включён в проект.</p>

<p>Если вы не используете образец проект jQuery, получите оптимизатор, загрузив файл <a href="download.html#rjs">r.js file</a> и поместив его в любом месте вне зоны разработки.</p>

<p>В целях этого примера, исходный код RequireJS размещается по соседству с папкой <strong>webapp</strong>, которая содержит HTML страницу и папку scripts, в которой размещаются все скрипты. Полная структура папки:</p>

<ul>
<li>r.js  (файл, содержащий оптимизатор)</li>
<li>webapp/app.html</li>
<li>webapp/scripts/main.js</li>
<li>webapp/scripts/require-jquery.js</li>
<li>webapp/scripts/jquery.alpha.js</li>
<li>webapp/scripts/jquery.beta.js</li>
</ul>

<p>Then, in the scripts directory that has require-jquery.js and main.js, create a file called app.build.js with the following contents:</p>
Затем, в папке scripts, которая содержит require-jquery.js и main.js, создайте файл app.build.js со следующим содержанием:

<pre><code>({
    appDir: "../",
    baseUrl: "scripts",
    dir: "../../webapp-build",
    //Закомментируйте строку optimize, если хотите
    //минимизировать код с помощью UglifyJS.
    optimize: "none",

    paths: {
        "jquery": "require-jquery"
    },

    modules: [
        {
            name: "main",
            exclude: ["jquery"]
        }
    ]
})
</code></pre>

<p>Чтобы использовать оптимизатор, вам нужно установить <a href="http://nodejs.org">Node</a> или Java 6. Эти инструкции предполагают, что используется Node. Смотрите <a href="optimization.html">страницу Оптимизация</a> для дальнейших инструкций.</p>

<p>Чтобы начать сборку, перейдите в папку <strong>webapp/scripts</strong> и выполните следующую команду:</p>

<pre><code>node ../../r.js -o app.build.js
</code></pre>

<p>Теперь, в папке webapp-build в main.js будет встроено содержимое main.js, jquery.alpha.js и jquery.beta.js. Если вы потом загрузите файл app.html из папки webapp-build, вы не должны увидеть сетевые запросы jquery.alpha.js и jquery.beta.js.</p>

</div>

<div class="section">
<h2>
<a name="advanced">Дополнительные возможности использования</a>
<span class="sectionMark">&sect; 4</span>
</h2>

<p>Описанные выше действия позволят легко начать модульную разработку с jQuery, особено если вы используете плагины jQuery, которые предполагают, что jQuery уже загружен на странице. Компромисс с вышеописанным подходом использует комбинированный файл RequireJS и jQuery.</p>

<p>В идеале, вы не должны были включать jQuery в RequireJS, а просто использовать RequireJS для загрузки jQuery по требованию. Тем не менее, скрипты по умолчанию можно загрузить RequireJS по порядку и это работает не очень хорошо с плагинами jQuery.</p>

<p>Некоторые параметры:</p>

<ul>
    <li>Используйте <a href="api.html#config-shim">shim config</a> чтобы уточнить зависимости плагинов так, чтобы jQuery загружалась до загрузки плагинов</li>
    <li>Оберните плагины в вызов define().</li>    
</ul>

<p>В идеале все jQuery плагины, которые вы используете, должны опционально вызывать define() для регистрации в качестве модуля. Некоторые из используемых плагинов уже вызывают define() для регистрации в качестве AMD модуля. Если они этого не делают, вы можете сделать это самостоятельно:</p>

<pre><code>define(['jquery'], function ($) {
    //Plugin code goes here.
});
</code></pre>

<p>В дополнение, вы можете попросить автора плагина добавить опциональный вызов define() в его код. На <a href="https://github.com/umdjs/umd">umdjs project</a> есть некоторые ресурсы и примеры, которые могут в этом помочь. </p>

</div>
    </div>
    <div id="footer" class="mono">
        <span class="line">Последний релиз: <a href="http://requirejs.org/docs/download.html">2.1.4</a></span>
        <span class="line">Лицензия: <a href="https://github.com/jrburke/requirejs/blob/master/LICENSE">new BSD or MIT licensed</a></span>
        <span class="line">Дизайн сайта: <a href="http://andychung.ca">Andy Chung</a> &copy; 2011</span>
    </div>
</div>
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12706996-7']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
</body>
</html>
